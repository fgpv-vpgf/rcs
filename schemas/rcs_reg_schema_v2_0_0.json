{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "title": "RCS Schema",
    "description": "An RCS request object",
    "version": "2.0.0",

    "defs": {

        "metadata": {
            "type": "object",
            "oneOf": [
                { "properties": { "uuid": { "type": "string" } }, "additionalProperties": false },
                { "properties": { "metadata_url": { "type": "string" }, "catalogue_url": { "type": "string" } }, "additionalProperties": false }
            ]
        },

        "service": {
            "type": "object",
            "properties": {
                "service_url": { "type": "string" },
                "service_name": { "type": "string" },
                "metadata": { "$ref": "#/defs/metadata" }
            },
            "required": [ "service_url" ]
        },

        "serviceNode": {
            "oneOf": [
                { "$ref": "#/defs/basicNode" },
                { "$ref": "#/defs/featureNode" },
                { "$ref": "#/defs/imageryNode" },
                { "$ref": "#/defs/wmsNode" },
                { "$ref": "#/defs/dynamicNode" }
            ]
        },

        "basicNode": {
            "type": "object",
            "properties": {
                "service_url": { "type": "string" },
                "service_name": { "type": "string" },
                "metadata": { "$ref": "#/defs/metadata" }
            },
            "required": [ "service_url" ],
            "additionalProperties": false
        },

        "featureNode": {
            "type": "object",
            "properties": {
                "service_url": { "type": "string", "description": "The service endpoint URL" },
                "service_name": { "type": "string", "description": "Name of the service endpoint, used for display" },
                "metadata": { "$ref": "#/defs/metadata" },
                "service_type": { "type": "string", "enum": ["esriFeature"], "description": "Service type of the endpoint" },
                "display_field": { "type": "string", "description": "Default attribute for identifying features" },
                "loading_mode": { "type": "string", "enum": ["ondemand","snapshot"], "description": "Specifies the layer loading mode: either snapshot (load all data upfront) or ondemand (load data as needed); when not specified RCS will probe the service and make an intelligent guesss" },
                "max_allowable_offset": { "type": "integer", "minimum": 0, "description": "Simplification factor for the layer geometry" },
                "tolerance": { "type": "integer", "minimum": 0, "description": "Tolerance (in pixels) of feature queries" }
            },
            "required": [ "service_url", "service_type" ],
            "additionalProperties": false
        },

        "imageryNode": {
            "type": "object",
            "properties": {
                "service_url": { "type": "string", "description": "The service endpoint URL" },
                "service_name": { "type": "string", "description": "Name of the service endpoint, used for display" },
                "metadata": { "$ref": "#/defs/metadata" },
                "service_type": { "type": "string", "enum": ["esriTile", "esriImage"], "description": "Service type of the endpoint" }
            },
            "required": [ "service_url", "service_type" ],
            "additionalProperties": false
        },

        "wmsNode": {
            "type": "object",
            "properties": {
                "service_url": { "type": "string", "description": "The service endpoint URL" },
                "service_name": { "type": "string", "description": "Name of the service endpoint, used for display" },
                "metadata": { "$ref": "#/defs/metadata" },
                "service_type": { "type": "string", "enum": ["ogcWms"], "description": "Service type of the endpoint" },
                "scrape_only": { "type": "array", "items": { "type": "string", "minLength": 1 }, "minItems": 1 },
                "legend_format": { "type": "string" },
                "feature_info_format": { "type": "string", "enum": [ "text/html;fgpv=summary", "text/html", "text/plain", "application/json" ], "description": "If specified indicates that GetFeatureInfo should be enabled for this WMS and indicates the format that should be requested." }
            },
            "required": [ "service_url", "service_type" ],
            "additionalProperties": false
        },

        "dynamicNode": {
            "type": "object",
            "properties": {
                "service_url": { "type": "string", "description": "The service endpoint URL" },
                "service_name": { "type": "string", "description": "Name of the service endpoint, used for display" },
                "metadata": { "$ref": "#/defs/metadata" },
                "service_type": { "type": "string", "enum": ["esriDynamic"], "description": "Service type of the endpoint" },
                "scrape_only": { "type": "array", "items": { "type": "integer", "minimum": 0 }, "minItems": 1 }
            },
            "required": [ "service_url", "service_type" ],
            "additionalProperties": false
        }

    },

    "properties": {
        "version": { "type": "string", "enum": [ "2.0" ] },
        "en": {"$ref": "#/defs/serviceNode"},
        "fr": {"$ref": "#/defs/serviceNode"}
    },
    "required": ["version", "en", "fr"],
    "additionalProperties": false


}
